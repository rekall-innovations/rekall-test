#!/bin/bash
if [ "$1" == "ok" ]; then
   cp /Users/scudette/projects/rekall-test/unit/output/TestAFF4Acquire /Users/scudette/projects/rekall-test/unit/TestAFF4Acquire
elif [ "$1" == "meld" ]; then
   meld /Users/scudette/projects/rekall-test/unit/output/TestAFF4Acquire /Users/scudette/projects/rekall-test/unit/TestAFF4Acquire
elif [ "$1" == "diff" ]; then
   diff /Users/scudette/projects/rekall-test/unit/output/TestAFF4Acquire /Users/scudette/projects/rekall-test/unit/TestAFF4Acquire
elif [ "$1" == "run" ]; then
   rekall  -v --format 'test' --cache_dir '/Users/scudette/projects/rekall-test/unit/../profile_cache/' - aff4acquire /var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpGhL7zH/TestAFF4AcquireThread-1/output_image.aff4
else
   less /Users/scudette/projects/rekall-test/unit/output/TestAFF4Acquire
fi
exit 0
{
    "failours": {
        "testCase (rekall.plugins.tools.aff4acquire.TestAFF4Acquire)": {
            "testCase (rekall.plugins.tools.aff4acquire.TestAFF4Acquire)": "Traceback (most recent call last):\n  File \"/Users/scudette/projects/rekall/rekall-core/rekall/testlib.py\", line 234, in run\n    testMethod()\n  File \"/Users/scudette/projects/rekall/rekall-core/rekall/plugins/tools/aff4acquire.py\", line 419, in testCase\n    self.assertEqual(previous, current)\nAssertionError: 0 != 2\n"
        }
    }, 
    "errors": {
        "testCase (rekall.plugins.tools.aff4acquire.TestAFF4Acquire)": {
            "return_code": 1
        }
    }, 
    "logging": [
        "DEBUG:rekall.1:Logging level set to 10", 
        "DEBUG:rekall.1:Running plugin (aff4acquire) with args (()) kwargs ({'also_pagefile': False, 'destination': '/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpGhL7zH/TestAFF4AcquireThread-1/output_image.aff4', 'compression': 'snappy', 'also_files': False})", 
        "DEBUG:rekall.1:Voting round with base: None", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.vmem.VMSSAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating VMSSAddressSpace: No base address space provided", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.macho.MACHOCoreDump'> ", 
        "DEBUG:rekall.1:Failed instantiating MACHOCoreDump: Must stack on another address space", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.vmem.VMemAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating VMemAddressSpace: No base address space provided", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.ewf.EWFAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating EWFAddressSpace: No base address space provided", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.crash.WindowsCrashBMP'> ", 
        "DEBUG:rekall.1:Failed instantiating WindowsCrashBMP: Must stack on another address space", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.elfcore.KCoreAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating KCoreAddressSpace: Must stack on another address space", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.crash.WindowsCrashDumpSpace32'> ", 
        "DEBUG:rekall.1:Failed instantiating WindowsCrashDumpSpace32: No base address space provided", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.crash.WindowsCrashDumpSpace64'> ", 
        "DEBUG:rekall.1:Failed instantiating WindowsCrashDumpSpace64: No base address space provided", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.elfcore.Elf64CoreDump'> ", 
        "DEBUG:rekall.1:Failed instantiating Elf64CoreDump: Must stack on another address space", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.lime.LimeAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating LimeAddressSpace: Must be layered on another address space.", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.aff4.AFF4AddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating AFF4AddressSpace: Filename must be specified", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.pmem.MacPmemAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating MacPmemAddressSpace: Filename must be specified.", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.standard.FileAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating FileAddressSpace: Filename must be specified in session (e.g. session.SetParameter('filename', 'MyFile.raw').", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.mmap_address_space.MmapFileAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating MmapFileAddressSpace: Must be first Address Space", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.amd64.VTxPagedMemory'> ", 
        "DEBUG:rekall.1:Failed instantiating VTxPagedMemory: ", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.standard.GlobalOffsetAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating GlobalOffsetAddressSpace: File offset not specified.", 
        "DEBUG:rekall.1:Trying <class 'rekall.plugins.addrspaces.pagefile.PagefilePhysicalAddressSpace'> ", 
        "DEBUG:rekall.1:Failed instantiating PagefilePhysicalAddressSpace: Pagefile not specified", 
        "DEBUG:rekall.1:[Errno 13] Permission denied: '/dev/pmem'", 
        "INFO:rekall.1:Unpacking driver to /var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7", 
        "INFO:rekall.1:Loading driver from /var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7/MacPmem.kext", 
        "/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7/MacPmem.kext failed to load - (libkern/kext) not privileged; check the system/kernel logs for errors or try kextutil(8).", 
        "CRITICAL:rekall.1:Traceback (most recent call last):", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/session.py\", line 727, in RunPlugin", 
        "    result = plugin_obj.render(ui_renderer) or plugin_obj", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/plugins/tools/aff4acquire.py\", line 379, in render", 
        "    live.live()", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/plugins/tools/live_darwin.py\", line 101, in live", 
        "    [\"kextload\", full_driver_path])", 
        "  File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/subprocess.py\", line 540, in check_call", 
        "    raise CalledProcessError(retcode, cmd)", 
        "CalledProcessError: Command '['kextload', '/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7/MacPmem.kext']' returned non-zero exit status 77", 
        "", 
        "CRITICAL:root:Command '['kextload', '/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7/MacPmem.kext']' returned non-zero exit status 77. Try --debug for more information.", 
        "Traceback (most recent call last):", 
        "  File \"/Users/scudette/Dev/bin/rekall\", line 9, in <module>", 
        "    load_entry_point('rekall-core==1.4.0.post0.dev45', 'console_scripts', 'rekall')()", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/rekal.py\", line 108, in main", 
        "    user_session.RunPlugin(plugin_cls, **config.RemoveGlobalOptions(flags))", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/session.py\", line 730, in RunPlugin", 
        "    self._HandleRunPluginException(ui_renderer, e)", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/session.py\", line 727, in RunPlugin", 
        "    result = plugin_obj.render(ui_renderer) or plugin_obj", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/plugins/tools/aff4acquire.py\", line 379, in render", 
        "    live.live()", 
        "  File \"/Users/scudette/projects/rekall/rekall-core/rekall/plugins/tools/live_darwin.py\", line 101, in live", 
        "    [\"kextload\", full_driver_path])", 
        "  File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/subprocess.py\", line 540, in check_call", 
        "    raise CalledProcessError(retcode, cmd)", 
        "subprocess.CalledProcessError: Command '['kextload', '/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpRU0NV7/MacPmem.kext']' returned non-zero exit status 77"
    ], 
    "time_used": 1.4071381092071533, 
    "return_code": 1, 
    "output": [
        "Will use compression: https://github.com/google/snappy", 
        "Will load physical address space from live plugin."
    ], 
    "options": {
        "executable": "rekall ", 
        "--cache_dir": "/Users/scudette/projects/rekall-test/unit/../profile_cache/", 
        "--format": "test", 
        "tempdir": "/var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpGhL7zH/TestAFF4AcquireThread-1", 
        "executed_command": "rekall  -v --format 'test' --cache_dir '/Users/scudette/projects/rekall-test/unit/../profile_cache/' - aff4acquire /var/folders/y8/670pn1dx55x01z5fs_6r2gnh003jp1/T/tmpGhL7zH/TestAFF4AcquireThread-1/output_image.aff4", 
        "commandline": "aff4acquire %(tempdir)s/output_image.aff4", 
        "testdir": "/Users/scudette/projects/rekall-test/unit", 
        "test_class": "TestAFF4Acquire"
    }
}